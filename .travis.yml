language: shell

addons:
  homebrew:
    packages:
    update: false

stages:
  - "EDA Tools - Bitstream"
  - "EDA Tools - Simulation"
  - "EDA Tools - Synthesis"
  - "EDA Tools - PnR"
  - "EDA Tools - Formal"

jobs:
 include:
 # EDA Tools - Bitstream Tools
  # Linux - x86 64bit
  - stage: "EDA Tools - Bitstream"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=bit/icestorm
  - stage: "EDA Tools - Bitstream"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=bit/prjtrellis
#  # Linux - ARM64
#  - stage: "EDA Tools - Bitstream"
#    os: linux
#    dist: xenial
#    arch: arm64
#    env:
#    - PACKAGE=bit/icestorm
#  - stage: "EDA Tools - Bitstream"
#    os: linux
#    dist: xenial
#    arch: arm64
#    env:
#    - PACKAGE=bit/prjtrellis
  # Linux - Power
  - stage: "EDA Tools - Bitstream"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=bit/icestorm
  - stage: "EDA Tools - Bitstream"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=bit/prjtrellis
  # Windows
  - stage: "EDA Tools - Bitstream"
    os: windows
    env:
    - PACKAGE=bit/icestorm
  - stage: "EDA Tools - Bitstream"
    os: windows
    env:
    - PACKAGE=bit/prjtrellis
  # OSX
  - stage: "EDA Tools - Bitstream"
    os: osx
    osx_image: xcode8.3
    env:
    - PACKAGE=bit/icestorm

 # EDA Tools - Simulation
  # Linux - x86 64bit
  - stage: "EDA Tools - Simulation"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=sim/icarus
  - stage: "EDA Tools - Simulation"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=sim/verilator
  # Linux - Power
  - stage: "EDA Tools - Simulation"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=sim/icarus
  - stage: "EDA Tools - Simulation"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=sim/verilator
  # Windows
  - stage: "EDA Tools - Simulation"
    os: windows
    env:
    - PACKAGE=sim/icarus
  # OSX
  - stage: "EDA Tools - Simulation"
    os: osx
    osx_image: xcode8.3
    env:
    - PACKAGE=sim/icarus

 # EDA Tools - Synthesis
  # Linux - x86 64bit
  - stage: "EDA Tools - Synthesis"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=syn/yosys
  # Linux - Power
  - stage: "EDA Tools - Synthesis"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=syn/yosys
  # Windows
  - stage: "EDA Tools - Synthesis"
    os: windows
    env:
    - PACKAGE=syn/yosys
  # OSX
  - stage: "EDA Tools - Synthesis"
    os: osx
    osx_image: xcode8.3
    env:
    - PACKAGE=syn/yosys EXTRA_BUILD_ARGS="--no-test"

 # EDA Tools - Place and Route
  # Linux - x86 64bit
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=pnr/arachne
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=pnr/nextpnr/ice40
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=pnr/nextpnr/ecp5
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=pnr/nextpnr/generic
#  - stage: "EDA Tools - PnR"
#    os: linux
#    dist: xenial
#    arch: amd64
#    env:
#    - PACKAGE=pnr/vtr                 CONDA_CHANNELS=conda-forge
  # Linux - Power
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=pnr/arachne
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=pnr/nextpnr/ice40
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=pnr/nextpnr/ecp5
  - stage: "EDA Tools - PnR"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=pnr/nextpnr/generic
#  - stage: "EDA Tools - PnR"
#    os: linux
#    dist: xenial
#    arch: ppc64le
#    env:
#    - PACKAGE=pnr/vtr                 CONDA_CHANNELS=conda-forge
  # Windows
  - stage: "EDA Tools - PnR"
    os: windows
    env:
    - PACKAGE=pnr/nextpnr/ice40
  # OSX
  - stage: "EDA Tools - PnR"
    os: osx
    osx_image: xcode8.3
    env:
    - PACKAGE=pnr/nextpnr/ice40

 # EDA Tools - Formal
  # Linux - x86 64bit
  - stage: "EDA Tools - Formal"
    os: linux
    dist: xenial
    arch: amd64
    env:
    - PACKAGE=formal/symbiyosys
  # Linux - Power
  - stage: "EDA Tools - Formal"
    os: linux
    dist: xenial
    arch: ppc64le
    env:
    - PACKAGE=formal/symbiyosys
  # Windows
#  - stage: "EDA Tools - Formal"
#    os: windows
#    env:
#    - PACKAGE=formal/symbiyosys
  # OSX
#  - stage: "EDA Tools - Formal"
#    os: osx
#    osx_image: xcode8.3
#    env:
#    - PACKAGE=formal/symbiyosys

before_install:
 - source $TRAVIS_BUILD_DIR/.travis/common.sh
 - bash $TRAVIS_BUILD_DIR/.travis/fixup-git.sh
 - bash $TRAVIS_BUILD_DIR/.travis/download_sdk.sh
 - source $TRAVIS_BUILD_DIR/.travis/common.sh

install:
 - ./.travis/install.sh

script:
 - bash $TRAVIS_BUILD_DIR/.travis/script.sh

after_failure:
 - bash $TRAVIS_BUILD_DIR/.travis/after_failure.sh

after_success:
 - bash $TRAVIS_BUILD_DIR/.travis/after_success.sh

cache:
  directories:
   - $HOME/.conda/pkgs
